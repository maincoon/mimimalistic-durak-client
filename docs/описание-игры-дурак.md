# Описание игры "Дурак"

**Перечень игровых элементов:**

## Основные элементы

**Количество игроков:**

* 2 игрока
* 3 игрока
* 4 игрока
* 4 игрока (пара на пару)

**Терминология:**

* **Отбой** - буфер карт, которые может отбить либо забрать игрок во время хода.

### Роли игроков

* **Атакующий (A)** - игрок, которому принадлежит право первого хода в раунде.
  * Атакующий обязан сделать первый ход до истечения времени в таймере.
  * Если Атакующий не успевает совершить ход до истечения времени + резервное время, он проигрывает игру.
  * После первого хода Атакующий переходит в статус Подкидывающего и остается в этом статусе до конца раунда.
* **Защищающийся (D)** - игрок, на которого совершаются ходы во время раунда.
  * Если Защищающийся может отбить (определяется сервером), он обязан принять решение - или отбить карты, или выбрать "Забрать карты".
    * Если Защищающийся не успевает принять решение до истечения времени + резервное время, он проигрывает игру.
  * Если Защищающийся не может отбить (определяется сервером), он переходит в Неактивное состояние "забирающего".
* **Забирающий (Z)** - Состояние игрока, в котором он ожидает, пока другие игроки подкинут ему карты, согласно количеству карт у него на руках.
* **Подкидывающий (T)** - все игроки, кроме защищающегося. Имеют право ходить после совершения первого хода Атакующим, т.е. подкидывать карты соответствующего номинала тем, что уже есть на столе. Подкидывающие имеют два состояния:
  * **Пассивный Подкидывающий** - работает таймер Защищающегося, любой Подкидывающий может в это время совершить ход. При этом таймер Защищающегося обнуляется и запускается заново.
  * **Активный Подкидывающий** - Защищающийся либо отбил все карты на столе, либо забирает. Если еще есть возможность подкинуть, у всех Подкидывающих активируется таймер. В течении этого времени они могут:
    * Подкинуть еще карты. Если кто-то из Подкидывающих подкинул карту, ход переходит Защищающемуся, Подкидывающие переходят в статус пассивных.
    * Нажать "Конец хода". В этом случае Подкидывающий, который нажал кнопку, переходит в Неактивное состояние.
    * При завершении времени таймера у Подкидывающих автоматически активируется "Конец хода", раунд заканчивается.
* **Неактивное состояние** - состояние игрока, в котором он уже не может совершать действия до конца раунда. В Неактивном состоянии могут пребывать:
  * Подкидывающий:
    * в случае, если он нажал "Конец хода"
    * в случае, если у него закончилось время на ход
  * Защищающийся, если он выбрал "Забрать карты".
  * Неактивное состояние сбрасывается каждый раз, когда кто-то подкидывает карты на стол.

### Таймеры

В игре присутствуют три типа таймеров:

* **Таймер Атакующего** - Атакующий обязан сделать ход до истечения таймера. Если таймер Атакующего истекает, запускается резервное время.
* **Таймер Защищающегося** - таймер, который запускается, когда Защищающийся может отбить (определяется сервером). В это время Защищающийся может либо отбить карты, либо нажать "Забрать карты". Если он не совершает действий до окончания таймера, запускается резервное время.
  * Таймер Защищающегося обновляется, если кто-то подкидывает еще карту.
* **Таймер Подкидывающего** - таймер, который запускается для Подкидывающих в активном состоянии. Если таймер истекает, у Подкидывающего автоматически включается "Конец хода".
* **Резервное время** - дополнительный таймер, который служит "буфером", в случае если игрок замешкался.
  * Резервное время не обновляется до конца партии.

## Начало игры

**Раздача карт**

Игрокам раздается всего по 6 карт в закрытую, раздается по 1 карте, по часовой стрелке, начиная с игрока слева от сдающего.

Пример: П1 раздает, карты по одной раздаются на П2, П3, П4, П1, П2 и т.д.

**Первенство хода**

Первым ходит игрок с младшим козырем на руках. Сам козырь должен быть "засвечен" другим игрокам.

При этом сервер:

* определяет очередность хода по младшему козырю;
* дает команду на засвет соответствующей карты;
* запускает таймер хода соответствующего игрока.

Клиент:

* получает команду на засвет, отображает карту;
* отображает таймер хода у соответствующего игрока.

**Порядок раунда**

* Раунд начинается ходом Атакующего на Защищающегося.
* Ход совершается по часовой стрелке, на игрока по левую руку.
* Ходить можно любой одной картой, несколькими картами одинакового номинала (две восьмерки, три десятки и т.д.).
* Отбиваться можно одномастными картами старшего достоинства, козырем; козырь отбивают козырем старшего достоинства.
* Подкидывать можно карты того же номинала, что выложены на стол, подкидывать можно вне очереди.
* Правило максимального отбоя:
  * Игроки не могут подкинуть больше карт, чем есть на руках у защищающегося.
  * Максимальный отбой первого хода - 5 карт, последующих ходов - 6 карт.
* Условия окончания раунда:
  * Защищающийся игрок отбил все карты, которые ему подкинули, все Подкидывающие перешли в Неактивное состояние:
    * Все карты на столе уходят в отбой.
    * Право следующего хода переходит игроку, который защищался.
  * Защищающийся игрок не может или не хочет отбить карты и забирает их:
    * в этом случае атакующий и подкидывающие могут подкинуть еще карты (соблюдается правило максимального отбоя).
    * все выложенные на стол карты отдаются игроку, который защищался.
    * право следующего хода переходит игроку по левую руку от Защищающегося.

### Дополнительно

1. Отбой в первой партии = 5 карт.
2. Анимация перелета карты = N секунд.
3. Анимация отбоя битых карт = N секунд.
4. Отображение козыря: после того как игроки взяли все карты, козырь отображается в виде пиктограммы козыря на месте расположения колоды.
5. Алгоритм добора карт игрокам с колоды после хода: Карты добираются начиная с Атакующего игрока против часовой стрелки. Сначала атакующий добирает карты до 6 штук, после чего подкидывающие и защищающийся.

## Логика

**Описание ролей игроков и варианты их взаимодействия:**

* **Атакующий (A)** - игрок, которому принадлежит право первого хода в раунде.
  * Атакующий обязан сделать первый ход до истечения времени в таймере.
  * Если Атакующий не успевает совершить ход до истечения времени + резервное время, он проигрывает игру.
  * После первого хода Атакующий переходит в статус Подкидывающего и остается в этом статусе до конца раунда.
* **Защищающийся (D)** - игрок, на которого совершаются ходы во время раунда.
  * Если Защищающийся может отбить (определяется сервером), он обязан принять решение - или отбить карты, или выбрать "Забрать карты".
    * Если Защищающийся не успевает принять решение до истечения времени + резервное время, он проигрывает игру.
  * Если Защищающийся не может отбить (определяется сервером), он переходит в Неактивное состояние "забирающего".
* **Забирающий (Z)** - Состояние игрока, в котором он ожидает, пока другие игроки подкинут ему карты, согласно количеству карт у него на руках.
* **Подкидывающий (T)** - все игроки, кроме защищающегося. Имеют право ходить после совершения первого хода Атакующим, т.е. подкидывать карты соответствующего номинала тем, что уже есть на столе.

### Переводной дурак

**Правила перевода (должны быть выполнены все условия):**

1. Игра ведется в переводного дурака.
2. У игрока есть карта для перевода.
3. Игрок не покрыл ни одну из карт атакующих игроков.
4. У ближайшего оппонента игрока по часовой стрелке на руках карт больше или равно чем карт на доске +1.

**Роли игроков:**

* **Атакующий (A)** - игрок, которому принадлежит право первого хода в раунде.
  * Атакующий обязан сделать первый ход до истечения времени в таймере.
  * Если Атакующий не успевает совершить ход до истечения времени + резервное время, он проигрывает игру.
* **Защищающийся (D)** - игрок, на которого совершаются ходы во время раунда.
  * Если Защищающийся может отбить (определяется сервером), он обязан принять решение - или отбить карты, или выбрать "Забрать карты".
    * Если Защищающийся не успевает принять решение до истечения времени + резервное время, он проигрывает игру.
  * Если Защищающийся не может отбить (определяется сервером), он переходит в Неактивное состояние "забирающего".
* **Забирающий (Z)** - Состояние игрока, в котором он ожидает, пока другие игроки подкинут ему карты, согласно количеству карт у него на руках.
* **Подкидывающий (T)** - все игроки, кроме защищающегося. Имеют право ходить после совершения первого хода Атакующим, т.е. подкидывать карты соответствующего номинала тем, что уже есть на столе. Подкидывающие имеют два состояния:
  * **Пассивный Подкидывающий** - работает таймер Защищающегося, любой Подкидывающий может в это время совершить ход. При этом таймер Защищающегося обнуляется и запускается заново.
  * **Активный Подкидывающий** - Защищающийся либо отбил все карты на столе, либо забирает. Если еще есть возможность подкинуть, у всех Подкидывающих активируется таймер. В течении этого времени они могут:
    * Подкинуть еще карты. Если кто-то из Подкидывающих подкинул карту, ход переходит Защищающемуся, Подкидывающие переходят в статус пассивных.
    * Нажать "Конец хода". В этом случае Подкидывающий, который нажал кнопку, переходит в Неактивное состояние.
    * При завершении времени таймера у Подкидывающих автоматически активируется "Конец хода", раунд заканчивается.
* **Переводящий** - переходное состояние игрока, в момент когда на игрока совершают "Атаку", и при наличии у игрока, карты одинакового значения с картой "Атаки", игрок может перевести эту карту, на следующего игрока по часовой стрелки.
  * Соответственно переводящий игрок становится "Атакующим", а защищающимся следующий игрок, на которого был совершен перевод.
* **Неактивное состояние** - состояние игрока, в котором он уже не может совершать действия до конца раунда. В Неактивном состоянии могут пребывать:
  * **Подкидывающий**:
    * в случае если он нажал "Конец хода"
    * в случае, если у него закончилось время на ход
  * **Защищающийся**, если он выбрал "Забрать карты".
  * Неактивное состояние сбрасывается каждый раз, когда кто-то подкидывает карты на стол.

## Дурак 2х2

### Подкидной дурак 2х2

Парный дурак - разновидность игры дурак для четырех человек "двое на двое". Игроки, сидящие напротив друг друга играют в паре. Правила игры аналогичны классическим правилам дурака, с ключевым отличием, что партнеру карты не подкидываются.

**Основные правила:**

* Первым ходит тот, у кого на руках имеется козырь наименьшего достоинства.
* Правила ходов и подкидываний такие же, что и в обычном дураке.
* В случае отбоя ход переходит к отбивавшемуся. Если же он взял карты, то следующим ходит соперник, сидящий за ним.
* Игра заканчивается, когда игроки одной из пар остались без карт (и карты в колоде закончились). У соперников в игре может оставаться как один, так и оба игрока.
* В следующей партии первым ходит игрок победившей пары.

### Переводной дурак 2х2

Парный дурак - разновидность игры дурак для четырех человек "двое на двое". Игроки, сидящие напротив друг друга играют в паре. Правила игры аналогичны классическим правилам переводного дурака, с ключевым отличием, что партнеру карты не подкидываются.

**Основные правила:**

* Первым ходит тот, у кого на руках имеется козырь наименьшего достоинства.
* Правила ходов и подкидываний такие же, что и в обычном дураке.
* В случае отбоя ход переходит к отбивавшемуся. Если же он взял карты, то следующим ходит соперник, сидящий за ним.
* Игра заканчивается, когда игроки одной из пар остались без карт (и карты в колоде закончились). У соперников в игре может оставаться как один, так и оба игрока.
* В следующей партии первым ходит игрок победившей пары.

### Что является признаком Победы, Ничьей, Проигрыша в дураке

* **Победа** - остался без карт первый по окончанию раунда и раздачи карт из колоды (в колоде не осталось карт).
* **Победа на несколько человек** - остались без карт первыми по окончанию раунда и раздачи карт из колоды (в колоде не осталось карт).
* **Ничья** - все игроки участвующие в игре остались без карт в рамках раунда и в колоде не осталось карт.
* **Проигрыш** - это не победа и не ничья (остался с картами по окончании раунда и добора карт из колоды при условии что остальные игроки остались без карт).

### Распределение выигрышей

**Переводной и подкидной дурак:**
Призы между победителями делятся на равные части, в игре только 1 проигравший. В случае игры на очки, все победители получают по 1 очку, проигравший 0.

**Дурак 2х2:**
Выигрыш делится между командой победителей в соотношении 50 на 50 за вычетом рейка. В случае игры на очки команда победителей получает 1 очко, проигравшие 0 очков.
